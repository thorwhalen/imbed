

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>imbed.examples.batch_embeddings_examples &mdash; imbed 0.0.22 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css?v=4ae1632d" />

  
      <script src="../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../_static/documentation_options.js?v=96ec9c95"></script>
      <script src="../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../../_static/toggleprompt.js?v=d7ede5d2"></script>
      <script src="../../../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            imbed
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../module_docs/imbed.html">imbed</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../module_docs/imbed/base.html">imbed.base</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../module_docs/imbed/components.html">imbed.components</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../module_docs/imbed/components/clusterization.html">imbed.components.clusterization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../module_docs/imbed/components/components_util.html">imbed.components.components_util</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../module_docs/imbed/components/planarization.html">imbed.components.planarization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../module_docs/imbed/components/segmentation.html">imbed.components.segmentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../module_docs/imbed/components/vectorization.html">imbed.components.vectorization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../module_docs/imbed/data_prep.html">imbed.data_prep</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../module_docs/imbed/examples.html">imbed.examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../module_docs/imbed/examples/batch_embeddings_examples.html">imbed.examples.batch_embeddings_examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../module_docs/imbed/examples/boxes.html">imbed.examples.boxes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../module_docs/imbed/examples/boxes/planarize.html">imbed.examples.boxes.planarize</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../module_docs/imbed/examples/imbed_box_01.html">imbed.examples.imbed_box_01</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../module_docs/imbed/imbed_project.html">imbed.imbed_project</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../module_docs/imbed/imbed_types.html">imbed.imbed_types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../module_docs/imbed/mdat.html">imbed.mdat</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../module_docs/imbed/oa_batch_embeddings.html">imbed.oa_batch_embeddings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../module_docs/imbed/segmentation_util.html">imbed.segmentation_util</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../module_docs/imbed/stores_util.html">imbed.stores_util</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../module_docs/imbed/tests.html">imbed.tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../module_docs/imbed/tests/test_imbed_project.html">imbed.tests.test_imbed_project</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../module_docs/imbed/tests/test_segmentation.html">imbed.tests.test_segmentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../module_docs/imbed/tests/utils_for_tests.html">imbed.tests.utils_for_tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../module_docs/imbed/tools.html">imbed.tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../module_docs/imbed/util.html">imbed.util</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../module_docs/imbed/vector_db.html">imbed.vector_db</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">imbed</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">imbed.examples.batch_embeddings_examples</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for imbed.examples.batch_embeddings_examples</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Example usage of the batch embeddings module.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">imbed.oa_batch_embeddings</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">compute_embeddings</span><span class="p">,</span>
    <span class="n">EmbeddingsBatchProcess</span><span class="p">,</span>
    <span class="n">compute_embeddings_df</span><span class="p">,</span>
<span class="p">)</span>


<span class="c1"># Example 1: Simple blocking usage</span>
<div class="viewcode-block" id="simple_example">
<a class="viewcode-back" href="../../../module_docs/imbed/examples/batch_embeddings_examples.html#imbed.examples.batch_embeddings_examples.simple_example">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">simple_example</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Example usage of compute_embeddings in a blocking manner.</span>
<span class="sd">    This function computes embeddings for a list of text segments</span>
<span class="sd">    and prints the results.</span>

<span class="sd">    &gt;&gt;&gt; segments, embeddings = simple_example()  # doctest: +SKIP</span>
<span class="sd">    2025-03-28 14:41:06,828 - __main__ - INFO - Submitting batches for 4 segments</span>
<span class="sd">    2025-03-28 14:41:08,330 - __main__ - INFO - Submitted 1 batches</span>
<span class="sd">    2025-03-28 14:41:08,331 - __main__ - INFO - Monitoring 1 batches</span>
<span class="sd">    2025-03-28 14:41:14,062 - __main__ - INFO - Batch Batch(id=&#39;batch_67e6a6f40c408190aef26e761efd0b6f&#39;, completion_window=&#39;24h&#39;, created_at=1743169268, endpoint=&#39;/v1/embeddings&#39;, input_file_id=&#39;file-UkK9V2BcoTJosRCkPRdBTM&#39;, object=&#39;batch&#39;, status=&#39;validating&#39;, cancelled_at=None, cancelling_at=None, completed_at=None, error_file_id=None, errors=None, expired_at=None, expires_at=1743255668, failed_at=None, finalizing_at=None, in_progress_at=None, metadata=None, output_file_id=None, request_counts=BatchRequestCounts(completed=0, failed=0, total=0)) completed successfully</span>
<span class="sd">    2025-03-28 14:41:14,064 - __main__ - INFO - Batch processing complete: 1 successful, 0 failed</span>
<span class="sd">    Generated 4 embeddings</span>
<span class="sd">    First embedding (first 5 dimensions): [-0.018423624, -0.0072260704, 0.003638412, -0.054205045, -0.022725008]</span>
<span class="sd">    &gt;&gt;&gt; segments  # doctest: +SKIP</span>
<span class="sd">    [&#39;The quick brown fox jumps over the lazy dog.&#39;,</span>
<span class="sd">    &#39;Machine learning models transform input data into useful representations.&#39;,</span>
<span class="sd">    &#39;Embeddings capture semantic meaning in dense vector spaces.&#39;,</span>
<span class="sd">    &#39;Natural language processing enables computers to understand human language.&#39;]</span>
<span class="sd">    &gt;&gt;&gt; len(embeddings)  # doctest: +SKIP</span>
<span class="sd">    4</span>
<span class="sd">    &gt;&gt;&gt; len(embeddings[0])  # doctest: +SKIP</span>
<span class="sd">    1536</span>
<span class="sd">    &gt;&gt;&gt; len(embeddings[0][:5])  # doctest: +SKIP</span>
<span class="sd">    [-0.018421143, -0.007218754, 0.0036062053, -0.054197744, -0.022721948]</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Sample text segments</span>
    <span class="n">segments</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;The quick brown fox jumps over the lazy dog.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Machine learning models transform input data into useful representations.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Embeddings capture semantic meaning in dense vector spaces.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Natural language processing enables computers to understand human language.&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="c1"># Compute embeddings (blocking call)</span>
    <span class="n">result_segments</span><span class="p">,</span> <span class="n">embeddings</span> <span class="o">=</span> <span class="n">compute_embeddings</span><span class="p">(</span>
        <span class="n">segments</span><span class="o">=</span><span class="n">segments</span><span class="p">,</span>
        <span class="n">verbosity</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>  <span class="c1"># Show basic progress information</span>
        <span class="n">batch_size</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>  <span class="c1"># Small batch size for example purposes</span>
    <span class="p">)</span>

    <span class="c1"># Print results</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Generated </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">embeddings</span><span class="p">)</span><span class="si">}</span><span class="s2"> embeddings&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;First embedding (first 5 dimensions): </span><span class="si">{</span><span class="n">embeddings</span><span class="p">[</span><span class="mi">0</span><span class="p">][:</span><span class="mi">5</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">result_segments</span><span class="p">,</span> <span class="n">embeddings</span></div>



<span class="c1"># Example 2: Non-blocking usage with manual control</span>
<div class="viewcode-block" id="non_blocking_example">
<a class="viewcode-back" href="../../../module_docs/imbed/examples/batch_embeddings_examples.html#imbed.examples.batch_embeddings_examples.non_blocking_example">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">non_blocking_example</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Example usage of compute_embeddings in a non-blocking manner.</span>
<span class="sd">    Also demonstrates that when your segments are a dict (or Mapping), your output</span>
<span class="sd">    is also a dict.</span>

<span class="sd">    &gt;&gt;&gt; segment_keys, embeddings = non_blocking_example()  # doctest: +SKIP</span>
<span class="sd">    2025-03-28 14:57:35,443 - imbed.oa_batch_embeddings - INFO - Submitting batches for 4 segments</span>
<span class="sd">    2025-03-28 14:57:36,784 - imbed.oa_batch_embeddings - DEBUG - Submitted batch batch_67e6aad079b08190a0e2b45e1aecd628 with 2 segments</span>
<span class="sd">    2025-03-28 14:57:37,819 - imbed.oa_batch_embeddings - DEBUG - Submitted batch batch_67e6aad18d5081909ec022687e474f65 with 2 segments</span>
<span class="sd">    2025-03-28 14:57:37,820 - imbed.oa_batch_embeddings - INFO - Submitted 2 batches</span>
<span class="sd">    2025-03-28 14:57:37,820 - imbed.oa_batch_embeddings - INFO - Monitoring 2 batches</span>
<span class="sd">    2025-03-28 14:57:38,001 - imbed.oa_batch_embeddings - DEBUG - Batch Batch(id=&#39;batch_67e6aad079b08190a0e2b45e1aecd628&#39;, completion_window=&#39;24h&#39;, created_at=1743170256, endpoint=&#39;/v1/embeddings&#39;, input_file_id=&#39;file-E5GXa9wne4UxRPn6YSeJAV&#39;, object=&#39;batch&#39;, status=&#39;validating&#39;, ...) status: in_progress</span>
<span class="sd">    Initial status summary: {&#39;validating&#39;: 2, &#39;completed&#39;: 0, &#39;failed&#39;: 0}</span>
<span class="sd">    2025-03-28 14:57:38,419 - imbed.oa_batch_embeddings - DEBUG - Batch Batch(id=&#39;batch_67e6aad18d5081909ec022687e474f65&#39;, completion_window=&#39;24h&#39;, created_at=1743170257, endpoint=&#39;/v1/embeddings&#39;, input_file_id=&#39;file-V78FMHmz8xNkhfRtzkkBSP&#39;, object=&#39;batch&#39;, status=&#39;validating&#39;, ...) status: validating</span>
<span class="sd">    2025-03-28 14:57:41,589 - imbed.oa_batch_embeddings - INFO - Batch Batch(id=&#39;batch_67e6aad079b08190a0e2b45e1aecd628&#39;, completion_window=&#39;24h&#39;, created_at=1743170256, endpoint=&#39;/v1/embeddings&#39;, input_file_id=&#39;file-E5GXa9wne4UxRPn6YSeJAV&#39;, object=&#39;batch&#39;, status=&#39;validating&#39;, ...) completed successfully</span>
<span class="sd">    2025-03-28 14:57:41,793 - imbed.oa_batch_embeddings - DEBUG - Batch Batch(id=&#39;batch_67e6aad18d5081909ec022687e474f65&#39;, completion_window=&#39;24h&#39;, created_at=1743170257, endpoint=&#39;/v1/embeddings&#39;, input_file_id=&#39;file-V78FMHmz8xNkhfRtzkkBSP&#39;, object=&#39;batch&#39;, status=&#39;validating&#39;, ...) status: in_progress</span>
<span class="sd">    2025-03-28 14:57:43,999 - imbed.oa_batch_embeddings - DEBUG - Batch Batch(id=&#39;batch_67e6aad18d5081909ec022687e474f65&#39;, completion_window=&#39;24h&#39;, created_at=1743170257, endpoint=&#39;/v1/embeddings&#39;, input_file_id=&#39;file-V78FMHmz8xNkhfRtzkkBSP&#39;, object=&#39;batch&#39;, status=&#39;validating&#39;, ...) status: finalizing</span>
<span class="sd">    2025-03-28 14:57:47,555 - imbed.oa_batch_embeddings - INFO - Batch Batch(id=&#39;batch_67e6aad18d5081909ec022687e474f65&#39;, completion_window=&#39;24h&#39;, created_at=1743170257, endpoint=&#39;/v1/embeddings&#39;, input_file_id=&#39;file-V78FMHmz8xNkhfRtzkkBSP&#39;, object=&#39;batch&#39;, status=&#39;validating&#39;, ...) completed successfully</span>
<span class="sd">    2025-03-28 14:57:47,556 - imbed.oa_batch_embeddings - INFO - Batch processing complete: 2 successful, 0 failed</span>
<span class="sd">    Generated 4 embeddings for keys: [&#39;fox&#39;, &#39;ml&#39;, &#39;embeddings&#39;, &#39;nlp&#39;]</span>
<span class="sd">    &gt;&gt;&gt; segment_keys  # doctest: +SKIP</span>
<span class="sd">    [&#39;fox&#39;, &#39;ml&#39;, &#39;embeddings&#39;, &#39;nlp&#39;]</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Sample text segments as a DICTIONARY</span>
    <span class="n">segments</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;fox&quot;</span><span class="p">:</span> <span class="s2">&quot;The quick brown fox jumps over the lazy dog.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ml&quot;</span><span class="p">:</span> <span class="s2">&quot;Machine learning models transform input data into useful representations.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;embeddings&quot;</span><span class="p">:</span> <span class="s2">&quot;Embeddings capture semantic meaning in dense vector spaces.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;nlp&quot;</span><span class="p">:</span> <span class="s2">&quot;Natural language processing enables computers to understand human language.&quot;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="c1"># Get a process object instead of results</span>
    <span class="n">process</span> <span class="o">=</span> <span class="n">compute_embeddings</span><span class="p">(</span>
        <span class="n">segments</span><span class="o">=</span><span class="n">segments</span><span class="p">,</span>
        <span class="n">verbosity</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>  <span class="c1"># Show detailed progress information</span>
        <span class="n">batch_size</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>  <span class="c1"># Split into multiple batches</span>
        <span class="n">poll_interval</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span>  <span class="c1"># Check status every 3 seconds</span>
        <span class="n">return_process</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># Return the process instead of results</span>
    <span class="p">)</span>

    <span class="c1"># Submit batches</span>
    <span class="n">process</span><span class="o">.</span><span class="n">submit_batches</span><span class="p">()</span>

    <span class="c1"># Check status without blocking</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Initial status summary:&quot;</span><span class="p">,</span> <span class="n">process</span><span class="o">.</span><span class="n">get_status_summary</span><span class="p">())</span>

    <span class="c1"># Now monitor until completion (this will block)</span>
    <span class="n">process</span><span class="o">.</span><span class="n">monitor_batches</span><span class="p">()</span>

    <span class="c1"># Get and print results</span>
    <span class="n">segment_keys</span><span class="p">,</span> <span class="n">embeddings</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">aggregate_results</span><span class="p">()</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Generated </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">embeddings</span><span class="p">)</span><span class="si">}</span><span class="s2"> embeddings for keys: </span><span class="si">{</span><span class="n">segment_keys</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">segment_keys</span><span class="p">,</span> <span class="n">embeddings</span></div>



<span class="c1"># Example 3: Using as a context manager</span>
<div class="viewcode-block" id="context_manager_example">
<a class="viewcode-back" href="../../../module_docs/imbed/examples/batch_embeddings_examples.html#imbed.examples.batch_embeddings_examples.context_manager_example">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">context_manager_example</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Example usage of compute_embeddings as a context manager.</span>
<span class="sd">    This function computes embeddings for a list of text segments</span>
<span class="sd">    and prints the results.</span>

<span class="sd">    &gt;&gt;&gt; segments, embeddings = context_manager_example()  # doctest: +SKIP</span>
<span class="sd">    2025-03-28 15:00:02,999 - imbed.oa_batch_embeddings - INFO - Submitting batches for 4 segments</span>
<span class="sd">    2025-03-28 15:00:05,087 - imbed.oa_batch_embeddings - INFO - Submitted 2 batches</span>
<span class="sd">    2025-03-28 15:00:05,088 - imbed.oa_batch_embeddings - INFO - Monitoring 2 batches</span>
<span class="sd">    2025-03-28 15:00:16,313 - imbed.oa_batch_embeddings - INFO - Batch Batch(id=&#39;batch_67e6ab64cb408190b80daa5e8ab92bf7&#39;, completion_window=&#39;24h&#39;, created_at=1743170404, ... status=&#39;validating&#39;, ...) completed successfully</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Sample text segments</span>
    <span class="n">segments</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;The quick brown fox jumps over the lazy dog.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Machine learning models transform input data into useful representations.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Embeddings capture semantic meaning in dense vector spaces.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Natural language processing enables computers to understand human language.&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="c1"># Use as context manager for automatic cleanup</span>
    <span class="k">with</span> <span class="n">compute_embeddings</span><span class="p">(</span>
        <span class="n">segments</span><span class="o">=</span><span class="n">segments</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">return_process</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span> <span class="k">as</span> <span class="n">process</span><span class="p">:</span>
        <span class="c1"># Run the entire process</span>
        <span class="n">segments</span><span class="p">,</span> <span class="n">embeddings</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Generated </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">embeddings</span><span class="p">)</span><span class="si">}</span><span class="s2"> embeddings in context&quot;</span><span class="p">)</span>

    <span class="c1"># After context exit, the processing mall is cleared (if not persist_processing_mall)</span>

    <span class="k">return</span> <span class="n">segments</span><span class="p">,</span> <span class="n">embeddings</span></div>



<span class="c1"># Example 4: Using with pandas</span>
<div class="viewcode-block" id="pandas_example">
<a class="viewcode-back" href="../../../module_docs/imbed/examples/batch_embeddings_examples.html#imbed.examples.batch_embeddings_examples.pandas_example">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">pandas_example</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Example usage of compute_embeddings with pandas DataFrame.</span>
<span class="sd">    This function computes embeddings for a dictionary of text segments</span>
<span class="sd">    and returns the results as a pandas DataFrame.</span>

<span class="sd">    &gt;&gt;&gt; df = pandas_example()  # doctest: +SKIP</span>
<span class="sd">    2025-03-28 15:07:43,617 - imbed.oa_batch_embeddings - INFO - Submitting batches for 4 segments</span>
<span class="sd">    2025-03-28 15:07:45,843 - imbed.oa_batch_embeddings - INFO - Submitted 2 batches</span>
<span class="sd">    2025-03-28 15:07:45,844 - imbed.oa_batch_embeddings - INFO - Monitoring 2 batches</span>
<span class="sd">    2025-03-28 15:07:51,844 - imbed.oa_batch_embeddings - INFO - Batch Batch(id=&#39;batch_67e6ad3190048190ad587e2edd65ea33&#39;, ...) completed successfully</span>
<span class="sd">    2025-03-28 15:09:36,698 - imbed.oa_batch_embeddings - INFO - Batch Batch(id=&#39;batch_67e6ad306948819095e79cabd8263f0c&#39;, ...) completed successfully</span>
<span class="sd">    2025-03-28 15:09:36,700 - imbed.oa_batch_embeddings - INFO - Batch processing complete: 2 successful, 0 failed</span>
<span class="sd">    DataFrame shape: (4, 2)</span>
<span class="sd">    DataFrame index: [&#39;fox&#39;, &#39;ml&#39;, &#39;embeddings&#39;, &#39;nlp&#39;]</span>
<span class="sd">    First row segment: The quick brown fox jumps over the lazy dog.</span>
<span class="sd">    First row embedding (first 5 dims): [4.308471e-05, -0.006475493, -0.00071540475, 0.018186275, 0.023950174]</span>
<span class="sd">                                                        segment  \</span>
<span class="sd">    fox              The quick brown fox jumps over the lazy dog.   </span>
<span class="sd">    ml          Machine learning models transform input data i...   </span>
<span class="sd">    embeddings  Embeddings capture semantic meaning in dense v...   </span>
<span class="sd">    nlp         Natural language processing enables computers ...   </span>

<span class="sd">                                                        embedding  </span>
<span class="sd">    fox         [4.308471e-05, -0.006475493, -0.00071540475, 0...  </span>
<span class="sd">    ml          [-0.021480283, 0.02021441, 0.012085131, 0.0159...  </span>
<span class="sd">    embeddings  [-0.018421143, -0.007218754, 0.0036062053, -0....  </span>
<span class="sd">    nlp         [0.015456875, 0.0016184314, 0.012820516, -0.04...</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Sample text segments</span>
    <span class="n">segments</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;fox&quot;</span><span class="p">:</span> <span class="s2">&quot;The quick brown fox jumps over the lazy dog.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ml&quot;</span><span class="p">:</span> <span class="s2">&quot;Machine learning models transform input data into useful representations.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;embeddings&quot;</span><span class="p">:</span> <span class="s2">&quot;Embeddings capture semantic meaning in dense vector spaces.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;nlp&quot;</span><span class="p">:</span> <span class="s2">&quot;Natural language processing enables computers to understand human language.&quot;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="c1"># Get results as a pandas DataFrame</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">compute_embeddings_df</span><span class="p">(</span><span class="n">segments</span><span class="o">=</span><span class="n">segments</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1"># Display DataFrame information</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DataFrame shape: </span><span class="si">{</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DataFrame index: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;First row segment: </span><span class="si">{</span><span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;segment&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;First row embedding (first 5 dims): </span><span class="si">{</span><span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;embedding&#39;</span><span class="p">][:</span><span class="mi">5</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">df</span></div>



<span class="c1"># Example 5: Error handling demonstration</span>
<div class="viewcode-block" id="error_handling_example">
<a class="viewcode-back" href="../../../module_docs/imbed/examples/batch_embeddings_examples.html#imbed.examples.batch_embeddings_examples.error_handling_example">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">error_handling_example</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Example usage of compute_embeddings with error handling.</span>
<span class="sd">    This function demonstrates how to handle errors gracefully</span>
<span class="sd">    and continue processing valid segments.</span>
<span class="sd">    It intentionally includes invalid segments to trigger an error.</span>
<span class="sd">    The function will catch the error, print a message, and</span>
<span class="sd">    continue processing valid segments.</span>
<span class="sd">    This is useful for demonstrating error handling in a test environment.</span>

<span class="sd">    &gt;&gt;&gt; result_segments, embeddings = error_handling_example()  # doctest: +SKIP</span>
<span class="sd">    2025-03-28 15:13:39,827 - imbed.oa_batch_embeddings - INFO - Submitting batches for 4 segments</span>
<span class="sd">    2025-03-28 15:13:39,828 - imbed.oa_batch_embeddings - INFO - Submitting batches for 2 segments</span>
<span class="sd">    Caught expected error: TypeError: argument &#39;text&#39;: &#39;int&#39; object cannot be converted to &#39;PyString&#39;</span>
<span class="sd">    Correcting and continuing with valid segments...</span>
<span class="sd">    2025-03-28 15:13:40,891 - imbed.oa_batch_embeddings - INFO - Submitted 1 batches</span>
<span class="sd">    2025-03-28 15:13:40,892 - imbed.oa_batch_embeddings - INFO - Monitoring 1 batches</span>
<span class="sd">    2025-03-28 15:13:56,657 - imbed.oa_batch_embeddings - INFO - Batch Batch(id=&#39;batch_67e6ae94932c819092092eb1bf91f3c9&#39;, ...) completed successfully</span>
<span class="sd">    2025-03-28 15:13:56,659 - imbed.oa_batch_embeddings - INFO - Batch processing complete: 1 successful, 0 failed</span>
<span class="sd">    Successfully generated 2 embeddings after correction</span>
<span class="sd">    &gt;&gt;&gt; print(f&quot;{len(result_segments)=}, {len(embeddings)=}&quot;)  # doctest: +SKIP</span>
<span class="sd">    len(result_segments)=2, len(embeddings)=2</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Intentionally invalid segments to trigger an error</span>
        <span class="n">segments</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Valid text&quot;</span><span class="p">,</span> <span class="mi">123</span><span class="p">,</span> <span class="s2">&quot;Another valid text&quot;</span><span class="p">]</span>

        <span class="n">result_segments</span><span class="p">,</span> <span class="n">embeddings</span> <span class="o">=</span> <span class="n">compute_embeddings</span><span class="p">(</span><span class="n">segments</span><span class="o">=</span><span class="n">segments</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Caught expected error: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Show how to handle and continue</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Correcting and continuing with valid segments...&quot;</span><span class="p">)</span>
        <span class="n">valid_segments</span> <span class="o">=</span> <span class="p">[</span><span class="n">seg</span> <span class="k">for</span> <span class="n">seg</span> <span class="ow">in</span> <span class="n">segments</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">seg</span><span class="p">,</span> <span class="nb">str</span><span class="p">)]</span>
        <span class="n">result_segments</span><span class="p">,</span> <span class="n">embeddings</span> <span class="o">=</span> <span class="n">compute_embeddings</span><span class="p">(</span>
            <span class="n">segments</span><span class="o">=</span><span class="n">valid_segments</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="mi">1</span>
        <span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully generated </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">embeddings</span><span class="p">)</span><span class="si">}</span><span class="s2"> embeddings after correction&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">result_segments</span><span class="p">,</span> <span class="n">embeddings</span></div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright NO COPYRIGHT.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>